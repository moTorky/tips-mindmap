Android apps support two different types of debugging: 
1. Debugging on the level of the Java runtime with the *Java Debug Wire Protocol* (JDWP), and
2. Linux/Unix-style ptrace-based debugging on the native layer
> Dalvik and ART support the JDWP, a protocol for communication between the debugger and the Java virtual machine (VM) that it debugs. 

### debug java code
 #### **Debugging with jdb**
 ```bash
#!/bin/bash
#adb kill-server
#sleep 1
#adb start-server
#adb wait-for-device
cmd="adb shell am -D -n <package>/<Activity>";
echo $cmd;
exec $cmd &
# list and get last debugable app PID
app_debug_port=$(adb jdwp | tail -1);
echo "app_debug_port: $app_debug_port";
# forward TCP connection to JDWP 
cmd0="adb -d forward tcp:29882 jdwp:$app_debug_port";
echo $cmd0;
exec $cmd0 &
# suspend app and make it wait for debugger
cmd1="{ echo 'suspend'; cat; } | jdb -J-Duser.home=. -connect com.sun.jdi.SocketAttach:hostname=localhost,port=29882";
echo $cmd1;
exec $cmd1;
```
if run successfully the prompt changed to  `>` 
- run `?` for list all commands 
- `stop in <class>.<function>` to make breakpoint on that function
- `resume` resume the app
- `locals`: print local variables in current stack frame
- `set lvalue = expr`: assign new value to field/variable/array element
- `print/dump expr`: print information about an object
 #####  Debugging with IntelliJ 
 [[OWASP_MASTG.pdf#page=144&selection=217,0,217,8|OWASP_MASTG, page 144 debug using IntelliJ ]]
  first create your Android project in IntelliJ and copy the decompiled Java sources into the source folder, run debugger; use `step into`, `step out`  buttons and review variables to find secret and pass validation
#### debug native code
 > Native code on Android is packed into ELF shared libraries and runs just like any other native Linux program, which be debugged using standard tools `gdb`, `IDA pro`   
 
debug app using `gdbserver` and `adb`
1. `adb push $NDK/prebuilt/android-arm/gdbserver/gdbserver /data/local/tmp`
2. start app: ``adb shell am -n <>/<>`
3. get app PID
4. attach jdb using above snap code and `stop in java.lang.System.loadLibrary` to set a breakpoint before load the library
5. start gdb server`/data/local/tmp/gdbserver --attach localhost:1234 <App_PID>`
6. `adb forward tcp:1234 tcp:1234`
7. `$ $TOOLCHAIN/bin/gdb libnative-lib.so` and use port `1234` to connect